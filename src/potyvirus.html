<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Potyvirus</title>


    <!-- build:style vendor -->
    <link rel="stylesheet" href="../lib/jsorolla/vendor/font-awesome-4.1.0/css/font-awesome.min.css">
    <link type="text/css" rel="stylesheet" href="../lib/jsorolla/vendor/ext-5/theme-babel/theme-babel-all.css">
    <link type="text/css" rel="stylesheet" href="../lib/jsorolla/vendor/jquery.qtip.min.css"/>
    <!-- /build -->

    <!-- build:style css -->
    <link type="text/css" rel="stylesheet" href="../lib/jsorolla/styles/css/style.css"/>
    <!-- /build -->




    <!--Importing Web Component's Polyfill -->
    <script src="../lib/jsorolla/vendor/platform.js"></script>

    <!--Importing Custom Elements -->
    <link rel="import" href="../lib/jsorolla/src/lib/components/jso-color-picker.html">
    <link rel="import" href="components/pty-toolbar.html">
    <link rel="import" href="components/pty-header.html">


    <link rel="import" href="components/pty-4a.html">
    <link rel="import" href="components/pty-4b.html">
    <link rel="import" href="components/pty-4c.html">
    <link rel="import" href="components/pty-4d.html">
    <link rel="import" href="components/pty-4e.html">
    <link rel="import" href="components/pty-4f.html">
    <link rel="import" href="components/pty-effect-propagation.html">
    <link rel="import" href="components/pty-simpson-index.html">
    <link rel="import" href="components/pty-heatmap.html">




</head>
<body>



<!-- build:[src] http://cdn.sencha.io/ext/gpl/5.0.0/build/ -->
<script src="../lib/jsorolla/vendor/ext-5/ext-all.js"></script>
<!-- /build -->

<script type="text/javascript" src="../lib/jsorolla/vendor/highcharts/adapters/standalone-framework.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/highcharts/highcharts-all.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/highcharts/modules/heatmap.js"></script>

<!-- Workers directory -->
<script type="text/javascript">
    WORKERS_PATH = "./";
</script>

<!-- build:script vendor -->
<script type="text/javascript" src="../lib/jsorolla/vendor/underscore-min.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/backbone-min.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/rawdeflate.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/rgbcolor.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/canvg.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/xml2json.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/jszip.min.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/xlsx.min.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/jquery.min.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/three.min.js"></script>

<!-- These dependencies must go AFTER jquery -->
<script type="text/javascript" src="../lib/jsorolla/vendor/typeahead.min.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/jquery.qtip.min.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/jquery.cookie.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/jquery.sha1.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/purl.min.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/jquery.simplecolorpicker.js"></script>
<script type="text/javascript" src="../lib/jsorolla/vendor/d3.min.js"></script>
<!-- /build -->


<!-- build:script config -->
<script type="text/javascript" src="../lib/jsorolla/src/network-viewer/nv-config.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/cm-config.js"></script>
<!-- /build -->


<!-- build:script lib -->

<script type="text/javascript" src="../lib/jsorolla/src/lib/svg.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/utils.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/ux-window.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/network-edit-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/layout-configure-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/attribute-layout-configure-widget.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/lib/network/attributes/attribute-manager-idb.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/attributes/attribute-manager-store.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/network.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/network-session.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/network-config.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/graph.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/edge.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/edge-config.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/vertex.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/vertex-config.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/default-vertex-renderer.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/circos-vertex-renderer.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/default-edge-renderer.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/graph-layout.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/point.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/lib/cellbase-manager.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/lib/opencga-manager.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/opencga/generic-form-panel.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/opencga/check-browser.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/opencga/header-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/opencga/job-list-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/opencga/login-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/opencga/opencga-browser-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/opencga/profile-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/opencga/result-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/opencga/result-table.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/opencga/upload-widget.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/lib/data-adapter/network/dot-network-data-adapter.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/data-adapter/network/json-network-data-adapter.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/data-adapter/network/sif-network-data-adapter.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/data-adapter/network/text-network-data-adapter.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/data-adapter/network/xlsx-network-data-adapter.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/data-adapter/network/attribute-network-data-adapter.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/lib/data-source/data-source.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/data-source/file-data-source.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/data-source/string-data-source.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/network-file-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/dot-network-file-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/json-network-file-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/sif-network-file-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/text-network-file-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/xlsx-network-file-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/attribute-network-file-widget.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/attributes/attribute-edit-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/widgets/network/attributes/attribute-filter-widget.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/attributes/attribute-manager-store.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/lib/network/attributes/attribute-manager-idb.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/network-viewer/tool-bar.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/network-viewer/edition-bar.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/network-viewer/network-svg-layout.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/network-viewer/network-viewer.js"></script>


<script type="text/javascript">
    WORKERS_PATH = "../lib/jsorolla/src/lib/";
</script>
<!-- /build -->

<!-- build:script js -->

<script type="text/javascript" src="../lib/cell-maps/src/plugins/fatigo-plugin.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/plugins/intact-plugin.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/plugins/reactome-plugin.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/plugins/cellbase-plugin.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/plugins/intact-plugin.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/plugins/communities-structure-detection-plugin.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/plugins/topological-study-plugin.js"></script>

<script type="text/javascript" src="../lib/cell-maps/src/forms/reactome-fi-microarray-form.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/forms/snow-form.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/forms/network-miner-form.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/forms/fatigo-form.js"></script>


<!--<script type="text/javascript" src="../lib/cell-maps/src/cm-toolbar.js"></script>-->
<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/visual-attribute-widget.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/pie-attribute-widget.js"></script>

<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/attribute-control/attribute-control.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/attribute-control/color-attribute-control.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/attribute-control/number-attribute-control.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/attribute-control/select-attribute-control.js"></script>

<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/attribute-grid/attribute-grid.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/attribute-grid/string-attribute-grid.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/attribute-grid/number-attribute-grid.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/attribute-grid/list-string-attribute-grid.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/visual-attribute-widget/attribute-grid/list-number-attribute-grid.js"></script>

<script type="text/javascript" src="../lib/cell-maps/src/cell-maps-configuration.js"></script>
<script type="text/javascript" src="../lib/cell-maps/src/cell-maps.js"></script>

<script type="text/javascript" src="../lib/jsorolla/src/network-viewer-webgl/network-viewer-webgl.js"></script>
<script type="text/javascript" src="../lib/jsorolla/src/network-viewer-webgl/js/debugaxis.js"></script>

<script type="text/javascript" src="potyvirus.js"></script>
<!-- /build -->


<STYLE type="text/css">
    html {
        width: 100%;
        height: 100%;
        /*overflow: hidden;*/
    }

    body {
        margin: 0px;
        width: 100%;
        height: 100%;
    }

    #maincontent {
        width: 100%;
        margin: 0 auto;
    }
    #stats{
        width: 95%;
        margin: 0 auto;
    }

</STYLE>


<pty-header data-name="Potyvirus" data-description="Protein-protein interaction network analysis"></pty-header>
<div id="maincontent">

</div>
<!--<pty-effect-propagation></pty-effect-propagation>-->
<!--<pty-simpson-index></pty-simpson-index>-->

<script>
    Ext.onReady(function () {

        CELLBASE_HOST = "http://www.ebi.ac.uk/cellbase/webservices/rest";
        CELLBASE_VERSION = "v3";

        var potyvirusPorteinNames = {'P1': true, 'HC-Pro': true, 'P3': true, '6K1': true, 'CI': true, '6K2': true, 'VPg': true, 'Nia-Pro': true, 'Nib': true, 'CP': true, 'P3N-PIPO': true};

        var height = $('html').height() - 62;
        var width = $('html').width() - 2;

        var resizeTimer;

        var header = document.querySelector('pty-header');
        var mainContentEl = document.querySelector('#maincontent');


        var contentMap = {};
        contentMap['nv'] = document.createElement('div');
        contentMap['nv'].style.border = '1px solid lightgray';
        contentMap['nvwgl'] = document.createElement('div');


        contentMap['stats'] = document.createElement('div');
        contentMap['stats'].setAttribute('id', 'stats');
        var epEl = document.createElement('pty-heatmap');
        var siEl = document.createElement('pty-simpson-index');
        var aEl = document.createElement('pty-4a');
        var bEl = document.createElement('pty-4b');
        var cEl = document.createElement('pty-4c');
        var dEl = document.createElement('pty-4d');
        var eEl = document.createElement('pty-4e');
        var fEl = document.createElement('pty-4f');
        contentMap['stats'].appendChild(epEl);
        contentMap['stats'].appendChild(siEl);
        contentMap['stats'].appendChild(aEl);
        contentMap['stats'].appendChild(bEl);
        contentMap['stats'].appendChild(cEl);
        contentMap['stats'].appendChild(dEl);
        contentMap['stats'].appendChild(eEl);
        contentMap['stats'].appendChild(fEl);


//        mainContentEl.appendChild(contentMap['nv']);
        mainContentEl.appendChild(contentMap['stats']);


        header.addEventListener('menu-click', function (e) {
            while (mainContentEl.firstChild) {
                mainContentEl.removeChild(mainContentEl.firstChild);
            }
            mainContentEl.appendChild(contentMap[e.detail.value]);
        });


        var session = new NetworkSession();
        var networkViewer = new NetworkViewer({
            target: contentMap['nv'],
            sidePanel: false,
            overviewPanel: false,
            session: session,
            width: width,
            height: height
        });
        networkViewer.draw();


        var networkViewerWebgl = new NetworkViewerWebgl({
            target: contentMap['nvwgl'],
            width: width - 10,
            height: height - 10
        });


        // Resize
        $(window).resize(function (event) {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function () {
                var height = $('html').height() - 62;
                var width = $('html').width() - 2;
                networkViewer.resize({
                    width: width,
                    height: height
                });
            }, 500);
        });


        $.ajax({
            url: 'all.sif',
            success: function (data) {
                var attributeNetworkDataAdapter = new SIFNetworkDataAdapter({
                    dataSource: new StringDataSource(data),
                    handlers: {
                        'data:load': function (event) {
                            networkViewer.setGraph(event.graph);
                            networkViewer.setLayout('Force directed');


                            //3D
                            var graph = event.graph;
                            var vertices = event.graph.vertices;
                            var edges = event.graph.edges;

                            var virusVertices = [];
                            var plantVertices = [];

                            for (var i = 0, l = vertices.length; i < l; i++) {
                                var vertex = vertices[i];
                                if (typeof vertex !== 'undefined') {
                                    if (vertex.id in potyvirusPorteinNames) {
                                        virusVertices.push(vertex);
                                    } else {
                                        plantVertices.push(vertex);
                                    }
                                }
                            }


                            circleLevels(virusVertices, 300, 50);
                            circleLevels(plantVertices, 500, 350);
                            networkViewerWebgl.renderGraph(graph);


                        },
                        'error:parse': function (event) {
                            console.log(event.errorMsg);
                        }
                    }
                });

                $.ajax({
                    url: 'interactions-1.3-weighted.attr',
                    success: function (data) {
                        var attributeNetworkDataAdapter = new AttributeNetworkDataAdapter({
                            dataSource: new StringDataSource(data),
                            handlers: {
                                'data:load': function (event) {
                                    var json = event.sender.getAttributesJSON();
                                    networkViewer.network.importEdgesWithAttributes({content: json});
//                                    configuration.propertiesPanel.setActiveTab(1);
//                                    configuration.edgeOpacityAttributeWidget.applyDirectVisualSet('Weight', 'String');
                                },
                                'error:parse': function (event) {
                                    console.log(event.errorMsg);
                                }
                            }
                        });
                    }
                });
            }
        });


    });

    function circleLevels(vertices, radius, z) {
        var centerX = 0;
        var centerY = 0;
        var x, y;
        for (var i = 0, l = vertices.length; i < l; i++) {
            var vertex = vertices[i];
            if (typeof vertex !== 'undefined') {
                x = centerX + radius * Math.sin(i * 2 * Math.PI / vertices.length);
                y = centerY + radius * Math.cos(i * 2 * Math.PI / vertices.length);

                vertex.position.set(x, y, z);
            }
        }
    }
     function force (args) {

        var network = args.graph;
        var width = args.width;
        var height = args.height;
        var friction = args.friction;
        var gravity = args.gravity;
        var chargeDistance = args.chargeDistance;

        var linkStrength = args.linkStrength;
        var linkDistance = args.linkDistance;
        var charge = args.charge;

        var multipliers = args.multipliers;

        var endFunction = args.end;
        var simulation = args.simulation;

        var force = d3.layout.force();

        //Global parameters
        force.size([width, height]);
        if (typeof  friction !== 'undefined') {
            force.friction(friction);

        }
        if (typeof gravity !== 'undefined') {
            force.gravity(gravity);

        }
        if (typeof  chargeDistance !== 'undefined') {
            force.chargeDistance(chargeDistance);

        }


        var vertices = graph.vertices;
        var edges = graph.edges;


        /*------------------------------------------*/
        /*------------------------------------------*/
        console.time('Force directed preload');

        force.nodes(vertices);
        force.links(edges);

        /*------------------------------------------*/
        /*------------------------------------------*/


        force.on('end', function (o) {
            console.log(o)
            endFunction(vertices);
        });

        if (simulation === true) {
            force.on('tick', function (o) {
                endFunction(vertices);
                console.log(force.alpha())
                if (force.alpha() < 0.025) {
                    force.stop()
                }
            });
            force.start();
        } else {
            console.time('D3 Force directed layout');
            force.start();
            var safety = 0;
            while (force.alpha() > 0.025) { // You'll want to try out different, "small" values for this
                force.tick();
                if (safety++ > 1000) {
                    break;// Avoids infinite looping in case this solution was a bad idea
                }
            }
//            console.log(safety);
            force.stop();
            console.timeEnd('D3 Force directed layout');
        }

    }

</script>

</body>
</html>

