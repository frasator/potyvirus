<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymer-fontawesome/polymer-fontawesome.html">
<link rel="import" href="../bower_components/sortable-table/sortable-table.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-header.html">
<link rel="import" href="../lib/jsorolla/src/lib/components/opencga/jso-project-browser.html">
<link rel="import" href="potyvirus-home.html">


<link rel="import" href="components/pty-toolbar.html">
<link rel="import" href="components/pty-header.html">
<link rel="import" href="components/pty-3d-toolbar.html">
<link rel="import" href="components/potyvirus-interactions-table.html">

<link rel="import" href="components/pty-4a.html">
<link rel="import" href="components/pty-4b.html">
<link rel="import" href="components/pty-4c.html">
<link rel="import" href="components/pty-4d.html">
<link rel="import" href="components/pty-4e.html">
<link rel="import" href="components/pty-4f.html">
<link rel="import" href="components/pty-effect-propagation.html">
<link rel="import" href="components/pty-simpson-index.html">
<link rel="import" href="components/pty-heatmap.html">


<polymer-element name="potyvirus-element">
    <template>
        <style>
            :host {
                display: block;
                position: relative;
                background-color: #314559;

                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                cursor: default;

                font-size: 13px;
            }

            [hide=true] {
                display: none !important;
            }

            [hide=false] {
                display: initial !important;
            }

            potyvirus-interactions-table {
                height: calc(100vh - 60px);
            }

            #stats {
                background-color: #FFFFFF;
                text-align: center;
                border-top: 1px solid #d3d3d3;
                padding-top: 20px;
            }

        </style>
        <jso-header selectedOption="{{selectedOption}}" userData="{{userData}}" appTitle="Potyvirus" allowLogin="false"
                    options="{{options}}">
        </jso-header>

        <potyvirus-home hide="{{selectedOption != 'home' }}"></potyvirus-home>

        <template if="{{selectedOption == 'stats' }}">
            <div id="stats">
                <pty-heatmap></pty-heatmap>
                <pty-simpson-index></pty-simpson-index>
                <pty-4a></pty-4a>
                <pty-4b></pty-4b>
                <pty-4c></pty-4c>
                <pty-4d></pty-4d>
                <pty-4e></pty-4e>
                <pty-4f></pty-4f>
            </div>
        </template>

        <potyvirus-interactions-table data="{{data}}" hide="{{selectedOption != 'interactions'}}"></potyvirus-interactions-table>

    </template>
    <script>
        Polymer({
            created: function () {
                this.data = [];
                this.selectedOption = 'home';
                this.userData;
                this.options = this.getOptions();

                this.getData();
            },
            ready: function () {

            },
            handleAppMenu: function (e) {
                this.$.sidePanel.classList.toggle('side-panel-shown');
            },
            getOptions: function () {
                return [
                    {
                        option: 'interactions',
                        text: 'Interactions'
                    },
                    {
                        option: 'vhpi',
                        text: 'VHPI'
                    },
                    {
                        option: 'vhpi3d',
                        text: 'VHPI3D'
                    },
                    {
                        option: 'stats',
                        text: 'Stats'
                    }
                ]
            },
            getData: function () {
                var me = this;
                var request = new XMLHttpRequest();
                request.onload = function () {
                    var lines = this.response.split('\n');
                    var data = [];
                    for (var i = 0; i < lines.length; i++) {
                        var fields = lines[i].split('\t');
                        var obj = {
                            id: fields[0],
                            p1: fields[1],
                            p2: fields[2],
                            reference: fields[3],
                            specie: fields[4],
                            cellularLocation: fields[5],
                            'function': fields[6],
                            detection: fields[7],
                            intensity: fields[8]
                        };
                        data.push(obj);
                    }
                    me.data = data;
                };
                request.onerror = function () {
                    console.log('error loading file');
                };
                request.open('GET', 'src/components/potyvirus-interactions-data-1.1.txt', true);
                request.send();
            }
        });
    </script>
</polymer-element>
